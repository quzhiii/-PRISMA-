# PRISMA 文献筛选助手 v1.7 功能测试清单

## 测试环境
- 浏览器: Chrome/Edge/Firefox (推荐Chrome)
- 测试网址: https://quzhiii.github.io/-PRISMA-/
- 或本地: `http://localhost:8000` (python -m http.server 8000)

---

## 测试场景 1: 基本功能验证

### ✅ 1.1 页面加载测试
- [ ] 打开index.html
- [ ] 验证标题显示 "PRISMA 文献筛选助手 v1.7"
- [ ] 验证副标题包含 "智能去重 • 关键词优先级保护"
- [ ] 验证5个步骤导航正确显示
- [ ] F12检查控制台无报错

### ✅ 1.2 v1.7补丁加载
在浏览器控制台(F12)执行：
```javascript
console.log(typeof performScreeningV17) // 应显示 "function"
console.log(typeof displayUploadInfoV17) // 应显示 "function"
```

---

## 测试场景 2: v1.7 新功能 - 关键词优先级保护

### 📋 测试数据准备
创建测试CSV文件 `test-priority.csv`:
```csv
title,abstract,year,authors
"Acupuncture for diabetes: A protocol study","This protocol describes...",2020,"Zhang Y"
"Acupuncture for diabetes: A RCT study","We conducted a randomized...",2021,"Li X"
"Animal acupuncture protocol for diabetes","In this animal study...",2019,"Wang M"
"Acupuncture effectiveness study","Results showed significant...",2022,"Chen L"
```

### ✅ 2.1 测试优先级保护开启（默认）
**步骤:**
1. 上传 `test-priority.csv`
2. 进入Step 2配置规则
3. 包含关键词输入: `acupuncture`
4. 排除关键词添加: `protocol` (理由: Protocol文章)
5. **确认勾选** "🛡️ 启用保护机制"
6. 点击"开始筛选"

**预期结果:**
- ✅ 4篇文章中应保留 **3篇**
- ✅ 第1篇 "Acupuncture for diabetes: A protocol study" 应该被**保留**（因为有优先级保护）
- ✅ 第2篇 "Acupuncture for diabetes: A RCT study" 应该被保留
- ✅ 第3篇 "Animal acupuncture protocol for diabetes" 应该被**保留**（因为有acupuncture）
- ✅ 第4篇 "Acupuncture effectiveness study" 应该被保留
- ✅ 结果页面应显示 "被保护文献: 2篇" 或类似提示

### ✅ 2.2 测试优先级保护关闭
**步骤:**
1. 返回Step 2
2. **取消勾选** "🛡️ 启用保护机制"
3. 重新开始筛选

**预期结果:**
- ✅ 应保留 **2篇** (第2篇和第4篇)
- ❌ 第1篇应该被排除（因为包含protocol）
- ❌ 第3篇应该被排除（因为包含protocol）

---

## 测试场景 3: v1.7 新功能 - 增强型去重

### 📋 测试数据准备
创建两个文件模拟跨库去重:

**test-pubmed.csv:**
```csv
title,abstract,year,doi
"Effect of meditation on stress","Meditation reduces stress...",2020,10.1234/abc.001
"Yoga for anxiety relief","Yoga practice improves...",2021,10.1234/abc.002
```

**test-wos.csv:**
```csv
Title,Abstract,Publication Year,DOI
"Effect of meditation on stress","Meditation reduces stress levels...",2020,10.1234/abc.001
"Yoga for anxiety","Yoga practice...",2021,10.1234/abc.002
"Mindfulness training","Mindfulness helps...",2022,10.1234/abc.003
```

### ✅ 3.1 测试去重统计卡片显示
**步骤:**
1. 同时上传 `test-pubmed.csv` 和 `test-wos.csv`
2. 观察Step 1上传后的界面

**预期结果:**
- ✅ 显示醒目的**去重统计卡片**
- ✅ 原始记录数: 5篇
- ✅ 去重后记录数: 3篇
- ✅ DOI重复: 2篇
- ✅ 标题重复: 0篇（或显示具体数量）
- ✅ 卡片颜色明显（建议蓝色或绿色背景）

### ✅ 3.2 测试"仅去重导出"功能
**步骤:**
1. 在去重统计卡片下方找到 "📥 仅去重导出 (CSV)" 按钮
2. 点击按钮

**预期结果:**
- ✅ 自动下载CSV文件（文件名类似 `deduped_literature_20260115.csv`）
- ✅ 打开文件，应包含 **3条记录**
- ✅ 每条记录都是唯一的（无重复）
- ✅ 文件编码UTF-8，中文正常显示

### ✅ 3.3 测试去重详情查看
**步骤:**
1. 点击去重统计卡片中的 "🔍 查看去重详情" 链接
2. 查看弹出的详情面板

**预期结果:**
- ✅ 显示被去重的文献列表
- ✅ 每条记录标注去重原因（"DOI重复" 或 "标题重复"）
- ✅ 显示原始记录和重复记录的对比
- ✅ 支持导出去重报告

---

## 测试场景 4: 回归测试（确保旧功能不受影响）

### ✅ 4.1 多文件上传
- [ ] 支持同时上传多个文件
- [ ] 自动识别RIS、CSV、BibTeX格式
- [ ] 显示文件数量和总记录数

### ✅ 4.2 筛选规则配置
- [ ] 时间窗口设置正常
- [ ] 包含关键词OR逻辑正确
- [ ] 排除关键词可添加多条
- [ ] 语言筛选正常
- [ ] YAML配置导入导出正常

### ✅ 4.3 PRISMA流程图生成
- [ ] 3种主题（彩色/黑白/柔和）正常切换
- [ ] SVG下载功能正常
- [ ] 统计数字准确
- [ ] 流程图布局无重叠

### ✅ 4.4 人工全文审查（Step 4）
- [ ] 可逐篇审查文献
- [ ] 排除理由选择正常
- [ ] 研究方法识别功能正常
- [ ] 统计更新实时

### ✅ 4.5 文件导出
- [ ] 纳入文献Excel导出正常
- [ ] 排除文献Excel包含排除理由
- [ ] 文件UTF-8编码，中文无乱码
- [ ] 所有字段完整

---

## 测试场景 5: 边界情况测试

### ✅ 5.1 空关键词测试
- [ ] 包含关键词留空，系统不过滤
- [ ] 排除关键词留空，系统不排除
- [ ] 两者都留空，只执行时间和语言过滤

### ✅ 5.2 大数据量测试
- [ ] 上传1000+条记录，性能正常
- [ ] 虚拟滚动列表流畅
- [ ] 去重统计准确

### ✅ 5.3 特殊字符测试
- [ ] 标题包含emoji
- [ ] 标题包含HTML标签
- [ ] 关键词包含特殊符号

---

## 测试场景 6: 浏览器兼容性

### ✅ 6.1 Chrome/Edge测试
- [ ] 所有功能正常
- [ ] 界面显示正常
- [ ] 无控制台错误

### ✅ 6.2 Firefox测试
- [ ] 核心功能正常
- [ ] 文件上传正常

### ✅ 6.3 Safari测试
- [ ] 基本功能可用
- [ ] 文件下载正常

---

## 测试记录表

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 页面加载 | ⬜ | |
| v1.7补丁加载 | ⬜ | |
| 关键词优先级(开启) | ⬜ | |
| 关键词优先级(关闭) | ⬜ | |
| 去重统计卡片 | ⬜ | |
| 仅去重导出 | ⬜ | |
| 去重详情查看 | ⬜ | |
| 多文件上传 | ⬜ | |
| PRISMA流程图 | ⬜ | |
| 人工审查 | ⬜ | |
| 文件导出 | ⬜ | |

---

## 常见问题排查

### 问题1: 页面显示v1.6而不是v1.7
**排查步骤:**
1. 检查 `index.html` 第8行 title是否为v1.7
2. 检查 `index.html` 第853行 H1标题是否为v1.7
3. F12查看是否加载了 `v1.7-core-patch.js`
4. 清除浏览器缓存后刷新

### 问题2: 找不到"启用保护机制"开关
**排查步骤:**
1. 进入Step 2配置规则页面
2. 找到"📌 包含关键词"输入框
3. 输入框下方应有紫色渐变卡片
4. 检查 `index.html` 是否包含 `includePriorityToggle` 元素

### 问题3: 去重统计卡片不显示
**排查步骤:**
1. 上传至少1个文件
2. 文件应包含可识别的字段（title/abstract）
3. F12控制台检查 `dedupStats` 对象是否有数据
4. 检查 `v1.7-core-patch.js` 是否正确加载

---

## 测试完成标准

✅ **通过标准:**
- 所有核心功能测试 ≥ 90%通过
- v1.7新功能100%可用
- 无阻塞性Bug
- 浏览器兼容性良好

❌ **失败标准:**
- 任何v1.7核心功能不可用
- 旧功能严重回归
- 存在数据丢失风险

---

**测试人员**: _________  
**测试日期**: _________  
**测试版本**: v1.7  
**测试结果**: ⬜ 通过 / ⬜ 失败  
**备注**: ___________________________

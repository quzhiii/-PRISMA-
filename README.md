#  PRISMA文献筛选助手 v1.5

一个强大的文献筛选和 PRISMA 2020 流程图生成工具，帮助研究者高效完成系统综述和荟萃分析的文献筛选工作。**v1.5 支持处理 3 万篇文献，采用 IndexedDB + Web Worker 架构，性能大幅提升。**

##  核心功能

###  v1.5 重大升级（大规模处理版）
-  **IndexedDB 数据层**：支持 30000+ 篇文献存储，突破 localStorage 限制
-  **Web Worker 并行处理**：文件解析和去重在后台线程执行，主线程不卡顿
-  **虚拟滚动列表**：只渲染可见的 100 条记录，内存占用降低 50%
-  **流式进度汇报**：导入和解析过程实时显示进度条
-  **分页查询 API**：按需加载数据，滚动流畅达到 60fps
-  **事务安全机制**：IndexedDB 事务保证数据不丢失
- 🚀 **智能自动分批**：单次导入文件可支持3万+篇，系统自动按5000条/批写入IndexedDB（4大核心机制）
  - **流式解析**：大文件分块读取，避免内存溢出
  - **Checkpoint机制**：每1000条创建检查点，失败可恢复
  - **队列背压控制**：自动调节解析和导入速度，防止浏览器卡死
  - **断点续传**：刷新页面可继续未完成的导入任务

###  v1.4 核心功能
-  **自定义排除原因模板**：支持项目级别的排除原因定制，不同项目互不干扰
-  **快捷键支持**：前6条排除原因可用数字键1-6快速选择，提升审核效率
-  **人工审核草稿持久化**：审核进度自动保存到localStorage，刷新页面不丢失
-  **规则修改重跑**：Step3支持"修改规则重跑"按钮，确认后重置人工审核数据
-  **PRISMA 2020标准流程图**：支持简化版和PRISMA 2020标准版两种导出模式
-  **规则概览展示**：结果页面显示所有应用的筛选规则，方便审计和报告
-  **Step5最终结果页**：人工审核完成后进入独立的最终结果页，流程更清晰

###  v1.3 核心功能
-  **多文件上传**：支持同时上传多个文献库文件（PubMed + CNKI + Zotero）
-  **跨库智能去重**：基于DOI和标题相似度的跨数据源去重
-  **来源追踪**：每条记录标记来源，PRISMA图显示真实来源分布
-  **Step4人工全文审核**：新增独立的全文审核步骤
-  **排除原因统计**：详细追踪每个排除原因的文献数量

###  v1.2 核心功能
-  **YAML规则配置**：支持导入/导出筛选规则为YAML文件
-  **规则预览**：实时预览规则应用效果
-  **Excel详细报告**：导出包含排除原因的完整Excel表格

###  v1.1 核心功能
-  **双人审查协作**：支持多审查员独立评估
-  **Cohen's Kappa分析**：计算评估者间一致性系数
-  **冲突解决机制**：自动识别不一致的评估结果

###  多格式支持
-  **CSV/TSV**：逗号/制表符分隔格式
-  **RIS/ENW**：Endnote/Zotero/Mendeley 导出格式  
-  **BibTeX**：LaTeX 文献管理格式
-  **RDF**：Zotero RDF/XML 格式
-  **TXT**：纯文本逐行解析
-  **多来源上传**：支持同时上传多个文件，自动跨库去重

###  智能筛选
-  **基于规则的自动筛选**：
  - 语言筛选（中英文）
  - 年份范围筛选
  - 关键词包含/排除（支持OR逻辑）
  - 期刊包含/排除  
  - 标题包含/排除
  - 作者包含/排除
-  **人工全文审核**：标题/摘要筛选后进入人工审核阶段
-  **排除原因追踪**：每条文献记录详细的排除理由和阶段
-  **智能去重**：基于 DOI + 归一化标题的跨库去重算法

###  可视化输出
-  **PRISMA 2020 流程图**：符合国际标准的 SVG 流程图  
-  **三种主题风格**：彩色、黑白、简约三种配色方案
-  **详细统计数据**：各阶段文献数量、来源分布、排除原因分析
-  **Excel 详细报告**：包含所有文献信息和排除原因的完整报表

##  快速开始

### 在线使用
访问 [GitHub Pages](https://quzhiii.github.io/-PRISMA-/) 即可使用，无需安装。

### 本地部署
```bash
# 克隆项目
git clone https://github.com/quzhiii/-PRISMA-.git
cd -PRISMA-

# 启动本地服务器（任选其一）
python -m http.server 5175
# 或
npx serve
```

然后在浏览器访问 `http://localhost:5175`

##  使用指南

### 基础流程
1. **Step 1: 上传文献文件**  
   - 支持单/多文件上传
   - 自动识别格式并解析
   - 显示来源分布统计

2. **Step 2: 配置筛选规则**  
   - 设置语言、年份、关键词等筛选条件
   - 保存为 YAML 配置文件（可复用）
   - 实时预览规则效果
使用建议
- 💡 **单次文件导入**：支持3万+篇文献上传，系统自动按5000条/批写入IndexedDB（无需手动分批）
- ⚠️ **浏览器性能**：若导入过程中浏览器卡顿，建议将大文件拆分为多个小文件（如每个文件1万条）
- 🔄 **断点续传**：导入过程中刷新页面，可从上次中断处继续（1小时内有效）
- 🔍 **精准规则**：在 Step2 配置尽可能精准的规则，减少人工审核量
- 📜 **虚拟滚动**：列表只渲染可见区域，滚动流畅不卡顿
- ⚡ **后台处理**：解析和去重在 Web Worker 执行，不阻塞界面
   - 逐条审核通过自动筛选的文献
   - 选择排除原因或保留
   - 使用快捷键1-6快速操作
   - 支持查看外部全文链接

5. **Step 5: 导出结果**  
   - 生成 PRISMA 流程图（SVG）
   - 导出详细 Excel 报告
   - 查看完整的筛选统计

### v1.5 性能优化指南
- 💡 **一键上传3万篇**：系统自动分批处理，无需手动分批（自动分6批，每批5000条）
- 🔄 **断点续传**：导入过程中刷新页面，可从上次中断处继续
- 🔍 **精准规则**：在 Step2 配置尽可能精准的规则，减少人工审核量
- 📜 **虚拟滚动**：列表只渲染可见区域，滚动流畅不卡顿
- ⚡ **后台处理**：解析和去重在 Web Worker 执行，不阻塞界面
- 💾 **本地存储**：所有数据存在浏览器 IndexedDB，无需服务器

### 高级功能
-  **YAML 配置导入/导出**：保存筛选规则为 `.yaml` 文件，项目间共享
-  **规则重跑机制**：修改规则后可重新筛选，自动清理旧的人工审核数据
-  **详细追踪**：Excel 导出包含每条文献的排除阶段和原因
-  **主题切换**：支持彩色/黑白/简约三种 PRISMA 图风格

##  技术架构

### v1.5 架构
```
┌─────────────────┐
│   index.html    │  UI 层：步骤向导 + 虚拟滚动列表
└────────┬────────┘
         │
┌────────▼────────┐
│     app.js      │  业务逻辑层：规则引擎 + 流程控制
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
┌───▼──┐  ┌──▼────┐
│ DB   │  │ Parser│  Web Worker 层
│Worker│  │ Worker│  后台线程处理
└───┬──┘  └──┬────┘
    │        │
┌───▼────────▼────┐
│   IndexedDB     │  数据层：30000+ 文献存储
└─────────────────┘
```

### 核心模块
- **db-worker.js**：IndexedDB CRUD 封装，支持批量插入、分页查询、事务管理
- **parser-worker.js**：8 种格式解析器，DOI/标题归一化，流式处理大文件
- **virtual-list.js**：虚拟滚动列表组件，只渲染可见区域 100 条
- **app.js**：主业务逻辑，规则引擎、PRISMA 生成、Excel 导出

### 关键技术
- **IndexedDB**：浏览器本地数据库，支持 GB 级数据存储
- **Web Worker**：多线程架构，避免主线程阻塞
- **虚拟滚动**：分页渲染技术，降低内存占用
- **流式处理**：边解析边存储，避免内存溢出

##  性能基准（v1.5）
| 操作              | 数据量   | 耗时      | 备注                    |
|-------------------|----------|-----------|-------------------------|
| 生成测试数据      | 30,000   | ~0.01s    | JavaScript 数组生成     |
| 导入 IndexedDB    | 30,000   | ~3-5s     | 批量插入，500条/批      |
| 分页查询          | 100      | ~213ms    | 索引查询，接近 200ms    |
| 虚拟滚动渲染      | 30,000   | ~16ms/帧  | 保持 60fps 流畅度       |

##  注意事项
-  **浏览器兼容性**：需要支持 IndexedDB 和 Web Worker（Chrome 60+, Firefox 55+）
-  **性能建议**：单文件可导入3万+篇，但若浏览器卡顿建议拆分为多个1万条的文件
-  **本地存储**：数据存在浏览器本地，清理缓存会丢失数据
-  **人工审核**：修改规则重跑后，人工审核进度会重置
-  **断点续传**：导入进度保存1小时，超时后需重新导入

##  未来工程化改进计划

### 🚀 即将实现（v1.6规划）
1. **可视化进度增强**
   - 3万篇导入时显示剩余时间估算
   - 增加暂停/继续按钮
   - 实时显示解析和写入速度

2. **全文查看优化**
   - Modal弹窗展示完整摘要
   - 全文链接统一在新标签页打开
   - 去重历史记录查看

3. **导入容错机制**
   - 环检式错误处理：捕获异常行/空行/格式错误
   - 显示"第X条记录失败，原因：XXX"的详细报告
   - 支持跳过错误继续导入

4. **去重策略可解释**
   - 展示标题归一化规则
   - 显示DOI优先级和相似度阈值设置
   - 让用户理解为什么被判定为重复

5. **规则版本控制**
   - 规则修改自动生成版本号
   - 导出报告时标注使用的规则版本
   - 支持回退到历史规则版本

6. **双人审查Kappa值计算**
   - 恢复v1.1的Cohen's Kappa分析功能
   - 可视化评估者间一致性
   - 冲突解决界面优化

7. **排除原因可视化**
   - 饼图/柱状图展示各类排除原因分布
   - 交互式图表，点击查看对应文献

8. **版本历史追溯**
   - 记录项目的所有操作历史
   - 支持导出版本对比报告

##  贡献指南
欢迎提交 Issue 和 Pull Request！

##  许可证
MIT License
